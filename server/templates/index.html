<!DOCTYPE html>
<html lang="ko">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Fleecy Cloud Participant - Dashboard</title>
		<link rel="stylesheet" href="/static/styles.css" />
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
			rel="stylesheet"
		/>
	</head>
	<body>
		<header class="app-header">
			<div class="container head">
				<div class="brand">
					<div class="logo">☁️</div>
					<div class="title">
						<h1>Fleecy Cloud Participant</h1>
						<p class="subtitle">로컬 서버 상태와 연합학습 작업을 한눈에</p>
					</div>
				</div>
				<nav class="nav">
					<a href="#overview">Overview</a>
					<a href="#vms">VM</a>
					<a href="#fl">Federated Learning</a>
					<a href="#logs">Logs</a>
				</nav>
			</div>
		</header>

		<main class="container">
			<section id="overview" class="card">
				<div class="card-head">
					<h2>서버 개요</h2>
					<button id="refresh-overview" class="btn">새로고침</button>
				</div>
				<div id="overview-content" class="grid two">
					<div class="stat">
						<div class="label">상태</div>
						<div id="status" class="value badge">-</div>
					</div>
					<div class="stat">
						<div class="label">시간</div>
						<div id="timestamp" class="value">-</div>
					</div>
				</div>
			</section>

			<section id="vms" class="card">
				<div class="card-head">
					<h2>VM 목록</h2>
					<div style="display: flex; gap: 8px; align-items: center">
						<button id="refresh-vms" class="btn">새로고침</button>
						<input
							id="ssh-check-ip"
							placeholder="직접 IP 입력"
							style="width: 160px"
						/>
						<button id="ssh-check-ip-btn" class="btn">IP로 SSH 체크</button>
					</div>
				</div>
				<div id="vms-content">
					<table class="table" id="vms-table">
						<thead>
							<tr>
								<th>ID</th>
								<th>Name</th>
								<th>Floating IP</th>
							</tr>
						</thead>
						<tbody></tbody>
					</table>
					<div id="vms-empty" class="empty">데이터가 없습니다.</div>
				</div>
			</section>

			<section id="fl" class="card">
				<div class="card-head">
					<h2>연합학습 실행</h2>
				</div>
				<form id="fl-form" class="form">
					<div class="form-row">
						<label for="vm_id">VM ID</label>
						<input id="vm_id" name="vm_id" placeholder="vm-xxxx" required />
					</div>

					<div class="form-section">
						<h3>연합학습 서버 설정</h3>
						<div class="form-row">
							<label for="remote_address">원격 Federation 주소</label>
							<input
								id="remote_address"
								name="remote_address"
								placeholder="예: 192.168.1.100:9092"
								title="Flower 서버의 IP:Port 주소"
							/>
						</div>
					</div>

					<div class="form-section">
						<h3>학습 파라미터</h3>
						<div class="grid two">
							<div class="form-row">
								<label for="epochs">Epochs</label>
								<input
									id="epochs"
									name="epochs"
									type="number"
									placeholder="5"
									min="1"
									title="학습 반복 횟수"
								/>
							</div>
							<div class="form-row">
								<label for="learning_rate">Learning Rate</label>
								<input
									id="learning_rate"
									name="learning_rate"
									type="number"
									step="0.0001"
									placeholder="0.001"
									title="학습률"
								/>
							</div>
						</div>
						<div class="grid two">
							<div class="form-row">
								<label for="batch_size">Batch Size</label>
								<input
									id="batch_size"
									name="batch_size"
									type="number"
									placeholder="32"
									min="1"
									title="배치 크기"
								/>
							</div>
							<div class="form-row">
								<label for="num_rounds">Rounds</label>
								<input
									id="num_rounds"
									name="num_rounds"
									type="number"
									placeholder="10"
									min="1"
									title="연합학습 라운드 수"
								/>
							</div>
						</div>
					</div>

					<div class="form-section">
						<h3>고급 설정 (선택사항)</h3>
						<div class="form-row">
							<label for="env_config">추가 설정 (JSON)</label>
							<textarea
								id="env_config"
								name="env_config"
								rows="3"
								placeholder='{"MODEL_NAME": "resnet18", "DATASET": "cifar10"}'
								title="JSON 형식의 추가 설정 파라미터"
							></textarea>
						</div>
					</div>

					<div class="form-actions">
						<button class="btn primary" type="submit">실행</button>
						<span id="fl-submit-status" class="hint"></span>
					</div>
				</form>

				<pre id="env-preview" class="code-block" hidden></pre>
				<div id="fl-result" class="code-block" hidden></div>
			</section>

			<section id="logs" class="card">
				<div class="card-head">
					<h2>작업 로그</h2>
				</div>
				<form id="logs-form" class="form small">
					<div class="form-row">
						<label for="log_task_id">Task ID</label>
						<input id="log_task_id" placeholder="fl-task-YYYYMMDD-HHMMSS" />
					</div>
					<div class="form-row">
						<label for="log_vm_id">VM ID</label>
						<input id="log_vm_id" placeholder="vm-xxxx" />
					</div>
					<div class="form-actions">
						<button id="btn-get-logs" class="btn">로그 조회</button>
					</div>
				</form>
				<pre id="logs-output" class="code-block" hidden></pre>
			</section>
		</main>

		<footer class="footer container">
			<span>© 2025 Fleecy Cloud</span>
		</footer>

		<script>
			window.APP_CONFIG = { baseUrl: "" };
		</script>
		<script src="/static/app.js"></script>
	</body>
</html>
